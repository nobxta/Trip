<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-600 to-indigo-900 flex justify-center items-center min-h-screen">

    <div class="bg-white shadow-2xl rounded-lg p-8 max-w-2xl w-full transition-all">
        <h2 class="text-3xl font-bold text-center text-gray-900">Trip Registration</h2>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
            <div id="progressBar" class="bg-indigo-600 h-2.5 rounded-full w-0 transition-all"></div>
        </div>

        <form id="tourForm" class="mt-6 space-y-6" enctype="multipart/form-data">
            
            <!-- Step 1: Number of People -->
            <div id="step-1">
                <label class="block text-sm font-medium text-gray-700">How many people?</label>
                <select id="peopleCount" class="w-full p-3 border rounded-lg" required onchange="generateUserForms()">
                    <option value="">Select</option>
                    <option value="1">1 Person</option>
                    <option value="2">2 People</option>
                    <option value="3">3 People</option>
                    <option value="4">4 People</option>
                    <option value="5">5 People</option>
                </select>

                <div class="flex justify-end mt-5">
                    <button type="button" onclick="validateStep(1, 2)" class="bg-indigo-600 text-white py-2 px-6 rounded-lg hover:bg-indigo-700">
                        Next
                    </button>
                </div>
            </div>

            <!-- Step 2: Contact Details -->
            <div id="step-2" class="hidden">
                <h3 class="font-semibold text-gray-900">Contact Details</h3>

                <label class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" id="email" class="w-full p-3 border rounded-lg" required>

                <label class="block text-sm font-medium text-gray-700">Mobile Number</label>
                <input type="tel" id="mobile" class="w-full p-3 border rounded-lg" required>

                <label class="flex items-center mt-4">
                    <input type="checkbox" id="sameAsMobile" class="mr-2" onchange="copyMobileToWhatsApp()">
                    <span class="text-gray-700">Use the same number for WhatsApp</span>
                </label>

                <label class="block text-sm font-medium text-gray-700 mt-2">WhatsApp Number</label>
                <input type="tel" id="whatsapp" class="w-full p-3 border rounded-lg" required>

                <div class="flex justify-between mt-5">
                    <button type="button" onclick="validateStep(2, 1)" class="bg-gray-500 text-white py-2 px-6 rounded-lg hover:bg-gray-600">
                        Back
                    </button>
                    <button type="button" onclick="validateStep(2, 3)" class="bg-indigo-600 text-white py-2 px-6 rounded-lg hover:bg-indigo-700">
                        Next
                    </button>
                </div>
            </div>

            <!-- Step 3: User Details -->
            <div id="step-3" class="hidden">
                <h3 class="font-semibold text-gray-900">User Details</h3>
                <div id="userDetailsContainer"></div>

                <div class="flex justify-between mt-5">
                    <button type="button" onclick="validateStep(3, 2)" class="bg-gray-500 text-white py-2 px-6 rounded-lg hover:bg-gray-600">
                        Back
                    </button>
                    <button type="button" onclick="validateStep(3, 4)" class="bg-indigo-600 text-white py-2 px-6 rounded-lg hover:bg-indigo-700">
                        Next
                    </button>
                </div>
            </div>

            <!-- Step 4: Terms & Conditions -->
            <div id="step-4" class="hidden">
                <h3 class="font-semibold text-gray-900">Terms & Conditions</h3>
                <p class="text-gray-600">By proceeding, you agree to our trip policies.</p>

                <label class="flex items-center mt-4">
                    <input type="checkbox" id="agreeTerms" class="mr-2">
                    <span class="text-gray-700">I agree to the Terms & Conditions</span>
                </label>

                <div class="flex justify-between mt-5">
                    <button type="button" onclick="validateStep(4, 3)" class="bg-gray-500 text-white py-2 px-6 rounded-lg hover:bg-gray-600">
                        Back
                    </button>
                    <button type="button" onclick="validateStep(4, 5)" class="bg-indigo-600 text-white py-2 px-6 rounded-lg hover:bg-indigo-700">
                        Next
                    </button>
                </div>
            </div>

            <!-- Step 5: Payment -->
            <div id="step-5" class="hidden">
                <h3 class="text-lg font-semibold text-gray-700">Scan & Pay</h3>
                <img src="assets/qr-code.png" alt="QR Code for Payment" class="w-40 mx-auto mt-2">

                <label class="block text-sm font-medium text-gray-700 mt-4">Transaction ID (TXID)</label>
                <input type="text" id="txid" class="w-full p-3 border rounded-lg" required>

                <button type="submit" class="w-full bg-green-500 text-white py-2 rounded-lg mt-5 hover:bg-green-600">
                    Confirm & Submit
                </button>
            </div>
        </form>

        <!-- Loading Animation -->
        <div id="loading" class="hidden text-center mt-4">
            <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-blue-500 mx-auto"></div>
            <p class="text-gray-600 mt-2">Processing your registration...</p>
        </div>
    </div>

    <script>
        document.getElementById("tourForm").addEventListener("submit", async function(event) {
            event.preventDefault();
            document.getElementById("loading").classList.remove("hidden");

            const formData = new FormData();
            formData.append("email", document.getElementById("email").value);
            formData.append("mobile", document.getElementById("mobile").value);
            formData.append("whatsapp", document.getElementById("whatsapp").value);
            formData.append("txid", document.getElementById("txid").value);

            try {
                const response = await fetch("http://localhost:3000/register", {
                    method: "POST",
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    window.location.href = "thank-you.html"; // Redirect to Thank You Page
                } else {
                    alert("❌ Error: " + result.message);
                    document.getElementById("loading").classList.add("hidden");
                }
            } catch (error) {
                console.error("Request failed:", error);
                alert("❌ Failed to connect.");
                document.getElementById("loading").classList.add("hidden");
            }
        });
    </script>

</body>
</html>
